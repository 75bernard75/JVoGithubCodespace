# ğŸš€ T3.3 - Build & Deploy Setup

**Task**: Configure automatic Eleventy builds and zero-downtime deployments  
**Status**: ğŸŸ¡ IN PROGRESS  
**Date**: February 1, 2026  
**Duration**: 2-3 days (2-3 hours actual work + server prep)

---

## ğŸ“‹ Overview

T3.3 makes your site automatically build and deploy whenever content changes:

```
Content change in Directus
       â†“
Export triggered (T3.2 âœ…)
       â†“
Export completes & commits
       â†“
Build workflow triggered (T3.3a - NEW)
  â€¢ Build Eleventy
  â€¢ Run tests
  â€¢ Upload artifact
       â†“
Deploy workflow triggered (T3.3b - NEW)
  â€¢ SSH to server
  â€¢ Upload files
  â€¢ Restart web server
       â†“
âœ… SITE LIVE WITH NEW CONTENT
```

---

## ğŸ¯ T3.3 Subtasks

### T3.3a: Build Trigger
**What it does**: Automatically builds Eleventy site when data changes

**Workflow**: `.github/workflows/build.yml` (already created)

**Triggers on**:
- Export workflow completes
- Changes to `data/directus-export.json`
- Manual trigger (anytime)

**Outputs**:
- Built site (`_site/` directory)
- Test results (4/4 passing)
- Artifact uploaded

**Status**: âœ… Ready (already in T3.1)

---

### T3.3b: Deploy Trigger
**What it does**: Automatically deploys built site to production server

**Workflow**: `.github/workflows/deploy.yml` (already created)

**Prerequisites**:
- [ ] Production server ready
- [ ] SSH access configured
- [ ] GitHub Secrets added (DEPLOY_*)
- [ ] Web server installed (nginx/Apache)

**Process**:
1. Download build artifact
2. SSH to production server
3. Upload files via rsync
4. Restart web server
5. Health check

**Status**: â³ Needs server setup

---

### T3.3c: Health Monitoring
**What it does**: Continuously verifies site is working

**Workflow**: `.github/workflows/health-check.yml` (already created)

**Runs**: Every 15 minutes automatically

**Checks**:
- Site responds (HTTP 200)
- Performance metrics
- Alerts on failure

**Status**: âœ… Ready (just needs server)

---

## ğŸ–¥ï¸ Server Setup (Critical)

Before deploying, you need a production server:

### Option 1: Rent a VPS (Recommended)
**Providers**: DigitalOcean, Linode, Vultr, AWS

**Requirements**:
- Linux (Ubuntu 20.04+)
- 1GB+ RAM
- 20GB+ disk
- SSH access
- ~$5-10/month

**Setup time**: 1 hour

### Option 2: Use Existing Server
**If you already have**: VPS, dedicated server, or hosting

**Requirements**:
- SSH access
- Root or sudo
- nginx/Apache
- ~30 minutes to configure

### Option 3: Docker Swarm (Advanced)
**For scaling**: Multiple servers, load balancing

**Requirements**:
- Multiple servers
- Docker knowledge
- ~2 hours setup

**â†’ We'll use Option 1 (VPS) for this guide**

---

## ğŸ”§ Detailed Setup Steps

### Step 1: Choose & Rent Server (1-2 hours)

**Recommendation**: DigitalOcean Droplet
- 1GB RAM / 1 vCPU / 25GB SSD
- Ubuntu 22.04 LTS
- $5-6/month

**After ordering**:
1. Receive server IP address
2. SSH access enabled
3. Ready to configure

---

### Step 2: Connect to Server (5 minutes)

```bash
# On your local machine
ssh root@YOUR_SERVER_IP

# First login will ask to accept key, type: yes
# You're now logged in to your server!
```

**What you'll see**:
```
root@jvo-gaming:~#
```

---

### Step 3: Initial Server Setup (15 minutes)

```bash
# Update system packages
apt update && apt upgrade -y

# Install essential software
apt install -y curl wget git nginx certbot python3-certbot-nginx htop

# Create non-root deploy user (security best practice)
useradd -m -s /bin/bash deploy
usermod -aG sudo deploy

# Create website directory
mkdir -p /var/www/jvogaming
chown deploy:deploy /var/www/jvogaming
chmod 755 /var/www/jvogaming

# Create logs directory
mkdir -p /var/log/jvogaming
chown deploy:deploy /var/log/jvogaming
chmod 755 /var/log/jvogaming
```

---

### Step 4: Setup Nginx (20 minutes)

Create nginx configuration:

```bash
# Edit nginx config
nano /etc/nginx/sites-available/jvogaming
```

**Paste this configuration**:
```nginx
# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name jvogaming.com www.jvogaming.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS server (main site)
server {
    listen 443 ssl http2;
    server_name jvogaming.com www.jvogaming.com;
    
    # SSL certificates (we'll setup next)
    ssl_certificate /etc/letsencrypt/live/jvogaming.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/jvogaming.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # Site directory
    root /var/www/jvogaming;
    index index.html;
    
    # Security headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;
    
    # Cache static files
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # Try files (for SPA if needed)
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

**Enable the site**:
```bash
ln -s /etc/nginx/sites-available/jvogaming /etc/nginx/sites-enabled/
nginx -t  # Test config
systemctl restart nginx
```

---

### Step 5: Setup HTTPS with Let's Encrypt (10 minutes)

```bash
# Get SSL certificate
certbot certonly --nginx \
  -d jvogaming.com \
  -d www.jvogaming.com

# Follow prompts:
# - Enter email
# - Accept terms
# - Choose certbot options

# Auto-renewal (runs automatically)
systemctl enable certbot.timer
systemctl start certbot.timer

# Test renewal
certbot renew --dry-run
```

**Result**: SSL certificate for your domain âœ…

---

### Step 6: Setup SSH Key for Deployment (15 minutes)

**On your SERVER**, create SSH key for GitHub:

```bash
# Switch to deploy user
su - deploy

# Generate SSH key
ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/github-deploy -N ""

# Display private key (copy this)
cat ~/.ssh/github-deploy

# Display public key
cat ~/.ssh/github-deploy.pub
```

**The private key looks like**:
```
-----BEGIN OPENSSH PRIVATE KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDL...
... (many lines)
-----END OPENSSH PRIVATE KEY-----
```

**Copy the entire private key** for GitHub Secrets (next step)

---

### Step 7: Verify Deployment Permission (5 minutes)

```bash
# Still as deploy user
# Allow deploy to restart nginx
sudo visudo

# Add this line at the end:
deploy ALL=(ALL) NOPASSWD: /usr/bin/systemctl

# Save: Ctrl+X â†’ Y â†’ Enter
```

**Result**: Deploy user can restart nginx without password prompt âœ…

---

## ğŸ” Step 8: Add GitHub Deployment Secrets

Go to: https://github.com/75bernard75/JVoGithubCodespace/settings/secrets/actions

**Add 4 new secrets** (for deployment):

### Secret 1: DEPLOY_HOST
```
Name:  DEPLOY_HOST
Value: jvogaming.com
```
(or your domain/IP)

### Secret 2: DEPLOY_USER
```
Name:  DEPLOY_USER
Value: deploy
```

### Secret 3: DEPLOY_PATH
```
Name:  DEPLOY_PATH
Value: /var/www/jvogaming
```

### Secret 4: DEPLOY_KEY
```
Name:  DEPLOY_KEY
Value: [Paste entire private key from Step 6]
```

**âš ï¸ IMPORTANT**: The private key is VERY LONG - paste the entire thing!

---

## ğŸ§ª Step 9: Test Deployment

### Verify Secrets Added

Check GitHub Secrets page - should see:
```
âœ“ DEPLOY_HOST
âœ“ DEPLOY_KEY
âœ“ DEPLOY_PATH
âœ“ DEPLOY_USER
âœ“ DIRECTUS_EMAIL
âœ“ DIRECTUS_PASSWORD
âœ“ DIRECTUS_URL
```

(Total 7 secrets now)

---

### Manual Test Deploy

**In GitHub**:

1. Go to: Actions â†’ Deploy to Production
2. Click: **Run workflow** button
3. Select: Branch: main
4. Click: **Run workflow**
5. Wait 5 minutes

**What you'll see**:
```
âœ… Checkout code
âœ… Setup Node.js
âœ… Build Eleventy
âœ… Download artifact
âœ… Setup SSH key
âœ… Deploy via SSH
âœ… Health check
```

**Status**: Should see green âœ… on all steps

---

### Verify on Server

```bash
# SSH to server
ssh deploy@jvogaming.com

# Check files uploaded
ls -la /var/www/jvogaming/

# Should see: index.html and other HTML files
# Verify your domain loads: https://jvogaming.com
```

---

## ğŸ”„ Complete Workflow (After Setup)

Once T3.3 is complete:

```
Every day at 2 AM UTC:
  1. Export workflow (T3.2) âœ…
  2. Build workflow (T3.3a) âœ…
  3. Deploy workflow (T3.3b) âœ…
  4. Health check (T3.4) âœ…

Result: Site has latest content
        Running on production server
        Available to visitors
        Monitored 24/7
```

**Manual trigger anytime**:
```
GitHub Actions â†’ Deploy to Production
  â†“
[Run workflow]
  â†“
5 minutes later
  â†“
Site updated!
```

---

## ğŸ“Š Success Criteria

T3.3 is complete when:

- [ ] Production server ready
- [ ] SSH access working
- [ ] Nginx configured
- [ ] HTTPS certificate working
- [ ] Deploy user created
- [ ] GitHub Secrets added (4 deploy secrets)
- [ ] Deploy workflow tests successfully
- [ ] Files upload to server
- [ ] Site loads on domain
- [ ] Health checks pass

---

## ğŸ†˜ Troubleshooting

### "Permission denied" (SSH)

**Fix**:
1. Verify private key is correct (full key in DEPLOY_KEY)
2. Check public key in server's ~/.ssh/authorized_keys
3. Test locally: `ssh -i key.pem deploy@server.com`

### "Connection timed out"

**Fix**:
1. Verify server IP is correct
2. Check firewall allows SSH (port 22)
3. Verify server is running

### "rsync: command not found"

**Fix**:
```bash
# SSH to server as root
apt install -y rsync
```

### Site shows old content

**Fix**:
1. Check files uploaded: `ls -la /var/www/jvogaming/`
2. Clear browser cache: Ctrl+Shift+Delete
3. Restart nginx: `sudo systemctl restart nginx`

### Domain doesn't resolve

**Fix**:
1. Check DNS points to server IP
2. Wait up to 24 hours for DNS
3. Use IP directly: `https://SERVER_IP/`

---

## ğŸ“‹ T3.3 Checklist

### Server Setup
- [ ] VPS rented and running
- [ ] SSH root access working
- [ ] System updated (`apt update && apt upgrade`)
- [ ] nginx installed
- [ ] certbot installed

### Configuration
- [ ] Website directory created (`/var/www/jvogaming`)
- [ ] nginx config created
- [ ] nginx enabled and running
- [ ] SSL certificate obtained
- [ ] Domain resolves to server IP

### Deployment User
- [ ] Deploy user created
- [ ] SSH key pair generated
- [ ] Public key in authorized_keys
- [ ] Sudo permissions set

### GitHub Setup
- [ ] 4 deployment secrets added
- [ ] DEPLOY_KEY has entire private key
- [ ] All secrets visible in GitHub settings

### Testing
- [ ] Deploy workflow triggered manually
- [ ] All steps show green âœ…
- [ ] Files appeared on server
- [ ] Domain loads in browser
- [ ] HTTPS works (ğŸ”’ icon shows)

---

## ğŸ¯ What's Ready vs What Needs Setup

### Already Done (T3.1)
âœ… `.github/workflows/build.yml` - Build trigger  
âœ… `.github/workflows/deploy.yml` - Deploy trigger  
âœ… `.github/workflows/health-check.yml` - Health monitoring

### You Need to Do (T3.3)
â³ Rent/prepare production server  
â³ Configure nginx & HTTPS  
â³ Setup SSH keys  
â³ Add GitHub Secrets  
â³ Test deployment

---

## â±ï¸ Timeline

```
T3.3a Build Trigger: Ready (from T3.1)
T3.3b Deploy Setup:  This guide (2-3 hours work)
T3.3c Health Check:  Ready (from T3.1)

Estimated T3.3 Time:
  Server rental:       1-2 hours
  Server setup:        1.5 hours
  Testing:             30 minutes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:               3-4 hours

Includes waiting for:
  - Server to boot
  - SSL certificate
  - DNS propagation
```

---

## ğŸš€ Next Steps After T3.3

### T3.4: Monitoring (Simple)
- Health checks already running
- Just verify they work
- Setup alerts (optional)

### LOT 4: Content Creation
- Add gaming console data
- Add guides & articles
- Optimize SEO

### Launch
- Final testing
- Security audit
- Go live! ğŸ‰

---

## ğŸ“š Reference

For help:
1. See: docs/DEPLOYMENT_GUIDE.md (detailed server setup)
2. See: docs/GITHUB_ACTIONS_SETUP.md (secrets reference)
3. See: START_LOT3.md (LOT 3 overview)

---

**Status**: Guide ready for T3.3 execution ğŸš€

**Next**: Start server setup (follow steps above)

